<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>mohammed tasks</title>
<meta name="theme-color" content="#c0c0c0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>


<style>
Â  /* ... (Ø£ÙƒÙˆØ§Ø¯ CSS Ø§Ù„Ø­Ø§Ù„ÙŠØ©) ... */
Â  :root{--bg:#c0c0c0;--fg:#000000;--accent:#000080;--accent-fg:#ffffff;--line-dark:#808080;--line-medium:#a0a0a0;--line-light:#ffffff;--input-fill:#ffffff;--font:'Tahoma', 'Arial', sans-serif;--progress-color:#008040;--subtle: #d0d0d0;--taskbar-green: #008080;}
Â  *{box-sizing:border-box;font-family: var(--font);font-size: 10pt;transition: none !important;}
Â  html,body{margin:0; background:var(--taskbar-green);}
Â  .wrap{max-width:400px;margin: 40px auto;padding:0;background: var(--bg);box-shadow: 6px 6px 0 var(--line-dark);position: relative;}
Â  .window {border-style: solid;border-width: 1px;border-color: var(--fg) var(--line-light) var(--line-light) var(--fg);padding: 2px;background: var(--bg);}
Â  .window-inner {border-style: solid;border-width: 1px;border-color: var(--line-dark) var(--line-light) var(--line-light) var(--line-dark);padding: 1px;background: var(--bg);}
Â  .title-bar {background: var(--accent);color: var(--accent-fg);padding: 3px 6px;font-size: 11pt;font-weight: bold;display: flex;justify-content: space-between;align-items: center;border-bottom: 1px solid var(--fg);background: linear-gradient(90deg, var(--accent) 0%, #1084d8 100%);}
Â  .title-bar-text { flex: 1; padding-left: 8px; display: flex; align-items: center; gap: 6px; }
Â  .title-bar-controls button {background: var(--bg);border: 1px solid var(--fg);border-right-color: var(--line-dark);border-bottom-color: var(--line-dark);border-top-color: var(--line-light);border-left-color: var(--line-light);width: 18px; height: 18px; font-size: 10pt; padding: 0; line-height: 1;cursor: default; font-weight: bold;}
Â  .title-bar-controls button:active {border-left-color: var(--line-dark);border-top-color: var(--line-dark);border-right-color: var(--line-light);border-bottom-color: var(--line-light);padding: 1px 0 0 1px;}
Â  .main-content { padding: 8px; }
Â  fieldset {border-style: solid; border-width: 1px;border-color: var(--line-dark) var(--line-light) var(--line-light) var(--line-dark);padding: 10px; margin: 8px 0; background: var(--bg);box-shadow: 1px 1px 0 var(--line-light) inset, -1px -1px 0 var(--line-dark) inset;}
Â  legend {background: var(--bg); padding: 0 6px; font-weight: bold; color: var(--accent); margin-left: 5px;}
Â  .controls{display:flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-bottom: 8px;}
Â  input[type="text"] {border: 1px solid var(--fg); border-left-color: var(--line-dark); border-top-color: var(--line-dark);border-right-color: var(--line-light); border-bottom-color: var(--line-light);background: var(--input-fill); color: var(--fg); padding: 4px 6px; font-size: 10pt;outline: none; box-shadow: none; flex: 1; min-width: 120px;}
Â  input:focus, .btn:focus, .del:focus, input[type="checkbox"]:focus, textarea:focus, input[type="date"]:focus {outline: 1px dashed var(--fg);outline-offset: -2px;}
Â  .btn {border: 1px solid var(--fg); border-right-color: var(--line-dark); border-bottom-color: var(--line-dark);border-top-color: var(--line-light); border-left-color: var(--line-light);background: var(--bg); color: var(--fg); padding: 5px 12px; font-weight: normal;cursor: pointer; box-shadow: none; line-height: 1; font-size: 10pt; flex-shrink: 0;}
Â  .btn:active {border: 1px solid var(--fg); border-left-color: var(--line-dark); border-top-color: var(--line-dark);border-right-color: var(--line-light); border-bottom-color: var(--line-light);padding: 6px 12px 4px 12px;}
Â  .btn.ghost { background: var(--bg); box-shadow: none; }
Â  .btn:hover { background: var(--subtle); }
Â  .btn:disabled { color: var(--line-dark); text-shadow: 1px 1px var(--line-light); cursor: not-allowed;} /* Style disabled buttons */
Â  .muted{color:var(--fg);font-size:9pt; padding: 0 4px;}
Â  .toolbar {display: flex; gap: 4px;padding: 0;margin-top: 8px;}
Â  .toolbar button {border: 1px solid var(--fg); border-right-color: var(--line-dark); border-bottom-color: var(--line-dark);border-top-color: var(--line-light); border-left-color: var(--line-light);padding: 4px 8px;flex: 1;}
Â  .toolbar button:active { padding: 5px 8px 3px 8px; }
Â  .task-list-box {border: 1px solid var(--fg); border-left-color: var(--line-dark); border-top-color: var(--line-dark);border-right-color: var(--line-light); border-bottom-color: var(--line-light);background: var(--input-fill); padding: 0; min-height: 100px; margin-top: 8px;box-shadow: 1px 1px 0 var(--line-dark) inset, -1px -1px 0 var(--line-light) inset;}
Â  ul{list-style:none;padding:0;margin:0}
Â  li{display:flex; align-items:center; gap:8px; padding: 4px 8px;background: var(--input-fill); color: var(--fg); margin: 0;border-bottom: 1px solid var(--line-medium);cursor: default;}
Â  li:hover { background: var(--subtle); }
Â  li.done { color: var(--line-dark); opacity: 0.9; }
Â  li.done .txt { text-decoration: line-through; }
Â  .txt{flex:1; line-height:1.4; font-size: 10pt; min-width: 0;}
Â  input[type="checkbox"]{appearance: none; width: 13px; height: 13px;border: 1px solid var(--fg); background: var(--input-fill);box-shadow: 1px 1px 0 var(--line-dark) inset, -1px -1px 0 var(--line-light) inset;margin: 0; padding: 0; display: grid; place-items: center; flex-shrink: 0;cursor: pointer;}
Â  input[type="checkbox"]:checked::after { content: 'âœ“'; color: var(--fg); font-size: 10pt; line-height: 0.8; }
Â  input[type="checkbox"]:active { box-shadow: 1px 1px 0 var(--line-light) inset, -1px -1px 0 var(--line-dark) inset; }
Â  input[type="checkbox"]:disabled { background: var(--subtle); box-shadow: none; cursor: not-allowed; } /* Style disabled checkbox */
Â  input[type="checkbox"]:disabled::after { color: var(--line-dark); }
Â  .del{appearance:none; border:0; background:transparent; color:var(--line-dark); font-size:10pt;cursor: pointer; padding: 0 4px; line-height:1; flex-shrink: 0;}
Â  .del:hover{color:red;}
Â  .del:disabled { color: var(--line-medium); cursor: not-allowed; } /* Style disabled delete */
Â  .linear-progress-box { margin-top: 8px; }
Â  .head{display:flex;justify-content:space-between;align-items:center;margin:0 0 4px 0}
Â  .big{font-weight:bold; font-size: 11pt;}
Â  .progress{height:14px; background: var(--line-dark);border: 1px solid var(--fg); border-left-color: var(--line-dark); border-top-color: var(--line-dark);border-right-color: var(--line-light); border-bottom-color: var(--line-light);overflow:hidden; padding: 2px;}
Â  .bar{ height:100%; width:0; background: var(--progress-color); }
Â  .status-bar {border-top: 1px solid var(--line-light);display: flex; align-items: center;padding: 0 0;background: var(--bg);height: 24px;position: absolute;bottom: -2px;left: 2px;right: 2px;width: calc(100% - 4px);}
Â  .start-btn {background: var(--bg);border: 1px solid var(--fg); border-right-color: var(--line-dark); border-bottom-color: var(--line-dark);border-top-color: var(--line-light); border-left-color: var(--line-light);font-weight: bold;padding: 1px 6px 0 6px;margin-right: 2px;height: 100%;line-height: 1.8;font-size: 11pt;color: var(--fg);cursor: pointer;box-shadow: none;flex-shrink: 0;}
Â  .start-btn:active {border: 1px solid var(--fg); border-left-color: var(--line-dark); border-top-color: var(--line-dark);border-right-color: var(--line-light); border-bottom-color: var(--line-light);padding: 2px 6px 0 7px;}
Â  .separator {height: 100%;width: 2px;background: var(--bg);border-left: 1px solid var(--line-light);border-right: 1px solid var(--line-dark);margin: 0 2px;}
Â  .status-panel-group {display: flex;margin-left: auto;align-items: center;height: 100%;}
Â  .status-panel {border: 1px solid var(--line-dark); border-left-color: var(--line-light); border-top-color: var(--line-light);padding: 0 8px; line-height: 2.1; font-size: 9pt; flex-shrink: 0; min-width: 60px;height: calc(100% - 4px);margin: 2px 0 2px 2px;}
Â  .main-content { padding: 8px 8px 30px 8px; }
Â  .counters-container {display: grid;grid-template-columns: 1fr 1fr 1fr;gap: 8px;padding: 0 0 8px 0;}
Â  .counter-fieldset {text-align: center;padding: 8px 5px 5px 5px;}
Â  .counter-fieldset legend {font-weight: bold;padding: 0 4px;font-size: 9pt;}
Â  .counter-fieldset h1 {font-size: 2.2rem;margin: 0 0 5px 0;font-weight: bold;color: #000;line-height: 1;}
Â  .counter-fieldset button {font-size: 1.1rem;font-weight: bold;width: 100%;height: 28px;padding: 0;}
Â  .counter-fieldset button:disabled {color: var(--line-dark);text-shadow: 1px 1px var(--line-light);cursor: not-allowed;}
Â  .emergency-fieldset {background-color: #CC4444;color: #FFFFFF;}
Â  .emergency-fieldset h1 {color: #FFFFFF;}
Â  .emergency-fieldset legend {color: #FFFFFF;background: #CC4444;}
Â  hr {border: 0;border-top: 1px solid var(--line-dark);border-bottom: 1px solid var(--line-light);margin: 15px 0;}
Â  .info-box fieldset {margin-top: 0;padding: 8px;}
Â  .info-box legend {font-size: 9pt;margin-left: 2px;}
Â  #emergency-log {width: 100%;box-sizing: border-box;font-family: var(--font);font-size: 9pt;background: var(--input-fill);color: var(--fg);border: 1px solid var(--fg);border-left-color: var(--line-dark);border-top-color: var(--line-dark);border-right-color: var(--line-light);border-bottom-color: var(--line-light);box-shadow: 1px 1px 0 var(--line-dark) inset, -1px -1px 0 var(--line-light) inset;}
Â  .status-panel-btn {cursor: pointer;border: 1px solid var(--line-light);border-right-color: var(--line-dark);border-bottom-color: var(--line-dark);}
Â  .status-panel-btn:active {border: 1px solid var(--line-dark);border-right-color: var(--line-light);border-bottom-color: var(--line-light);}
Â  #clippy-panel-btn {font-size: 1.2rem;line-height: 1.5;padding: 0 6px;min-width: 30px;}
Â  #report-panel-btn {padding: 0 6px;}
Â  #reset-today-panel-btn {padding: 0 6px;}
Â  #logon-screen {position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: var(--taskbar-green);display: flex;justify-content: center;align-items: center;z-index: 1000;}
Â  #logon-window {width: 350px;padding-bottom: 10px;}
Â  #logon-content {padding: 20px;display: flex;align-items: center;gap: 15px;}
Â  #logon-content i {font-size: 48px;color: var(--accent);}
Â  #logon-buttons {text-align: center;padding: 0 20px;}
Â  #logon-ok {width: 100px;}
Â  .dread-btn {appearance: none; border: 0; background: transparent;font-size: 1.1rem; cursor: pointer; padding: 0 4px; line-height: 1; flex-shrink: 0;}
Â  .dread-btn:hover { opacity: 0.6; }
Â  .dread-btn:active { transform: scale(0.9); }
Â  .dread-btn:disabled { cursor: not-allowed; opacity: 0.5; } /* Style disabled dread button */
Â  .dread-analysis-panel {padding: 5px;font-size: 0.95rem;}
Â  .dread-analysis-panel .task-name {font-weight: bold;color: var(--accent);}
Â  .history-controls {display: flex;gap: 8px;align-items: center;}
Â  .history-controls input[type="date"] {border: 1px solid var(--fg); border-left-color: var(--line-dark); border-top-color: var(--line-dark);border-right-color: var(--line-light); border-bottom-color: var(--line-light);background: var(--input-fill); color: var(--fg); padding: 4px 6px; font-size: 10pt;outline: none; box-shadow: none; flex: 1; height: 30px;}
Â  .history-controls button {flex-shrink: 0; height: 30px;}

Â  /* ğŸ”¥ ØªÙ†Ø³ÙŠÙ‚Ø§Øª ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
Â  .note-item {Â 
Â  Â  /* ğŸ”¥ [ØªØ¹Ø¯ÙŠÙ„] ØªØºÙŠÙŠØ± li Ù…Ù† flex Ø¥Ù„Ù‰ block Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ */
Â  Â  display: block; 
Â  Â  padding: 10px 8px;Â 
Â  Â  cursor: pointer;Â 
Â  Â  border-bottom: 1px solid var(--line-medium);Â 
Â  Â  background: var(--input-fill);
Â  }
Â  .note-item:hover { background: var(--subtle); }
Â  .note-item .txt {
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: var(--fg);
Â  }
Â  /* ğŸ”¥ [Ø¬Ø¯ÙŠØ¯] ØªÙ†Ø³ÙŠÙ‚ Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© */
Â  .note-item small {
Â  Â  Â  display: block;
Â  Â  Â  color: var(--line-dark);
Â  Â  Â  font-size: 9pt;
Â  Â  Â  padding-top: 2px;
Â  }
Â  #notes-editor-area {
Â  Â  Â  width: 100%;
Â  Â  Â  height: 200px;
Â  Â  Â  box-sizing: border-box; /* Important */
Â  Â  Â  border: 1px solid var(--fg);Â 
Â  Â  Â  border-left-color: var(--line-dark);Â 
Â  Â  Â  border-top-color: var(--line-dark);
Â  Â  Â  border-right-color: var(--line-light);Â 
Â  Â  Â  border-bottom-color: var(--line-light);
Â  Â  Â  background: var(--input-fill);Â 
Â  Â  Â  color: var(--fg);Â 
Â  Â  Â  padding: 4px 6px;Â 
Â  Â  Â  font-size: 10pt;
Â  Â  Â  outline: none;Â 
Â  Â  Â  box-shadow: 1px 1px 0 var(--line-dark) inset, -1px -1px 0 var(--line-light) inset;
Â  Â  Â  margin-bottom: 8px;
Â  }
Â  /* Ù†Ù‡Ø§ÙŠØ© ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */

Â  @media (max-width: 768px) {.wrap {max-width: 100%;margin: 0;height: 100vh;box-shadow: none;}.main-content { padding: 4px 4px 30px 4px; }.controls { flex-direction: column; align-items: stretch; gap: 4px; }.controls > * { width: 100%; }.controls label { flex: none; width: 100%; padding-bottom: 2px; }.toolbar button { flex: 1; }.task-list-box { min-height: 200px; }li { padding: 6px 8px; }.status-bar { width: 100%; left: 0; right: 0; bottom: 0; position: fixed; }.status-panel-group { margin-left: auto; }.counters-container {gap: 4px;padding: 4px 0 4px 0;}.counter-fieldset {padding: 6px 4px 4px 4px;}.counter-fieldset h1 {font-size: 1.8rem;}.counter-fieldset button {height: 24px;font-size: 1rem;}.counter-fieldset legend {font-size: 8pt;}.info-box p, .info-box .sunken-panel {font-size: 8pt;}.history-controls {flex-direction: column;align-items: stretch;}.history-controls input[type="date"] {margin-bottom: 4px;}}
</style>
</head>
<body dir="ltr">

Â  <div id="logon-screen">
Â  Â  <div class="window" id="logon-window">
Â  Â  Â  Â  <div class="title-bar">
Â  Â  Â  Â  Â  Â  <div class="title-bar-text">Logon to Mohammed's System</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="logon-content">
Â  Â  Â  Â  Â  Â  <i class="fas fa-user-circle"></i>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 0 0 5px 0;">Welcome back, <strong>Mohammed</strong>.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 0;">Click OK to load your task environment.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="logon-buttons">
Â  Â  Â  Â  Â  Â  <button class="btn" id="logon-ok">OK</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <main class="wrap window">
Â  Â  <div class="window-inner">
Â  Â  Â  <div class="title-bar">
Â  Â  Â  Â  Â  <div class="title-bar-text">
Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-user-circle"></i>
Â  Â  Â  Â  Â  Â  Â  <span>mohammed tasks</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="title-bar-controls">
Â  Â  Â  Â  Â  Â  Â  <button title="Minimize" class="title-btn-min">_</button>
Â  Â  Â  Â  Â  Â  Â  <button title="Maximize" class="title-btn-max">â–¡</button>
Â  Â  Â  Â  Â  Â  Â  <button title="Close" class="title-btn-close">X</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="main-content">

Â  Â  Â  Â  <div id="page-tasks">
Â  Â  Â  Â  Â  Â  <div class="counters-container">
Â  Â  Â  Â  Â  Â  Â  Â  <fieldset class="counter-fieldset">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <legend>Achievements</legend>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 id="achievements-count">0</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="counter_increment('achievements')" class="btn">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  </fieldset>
Â  Â  Â  Â  Â  Â  Â  Â  <fieldset class="counter-fieldset">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <legend>Neutral</legend>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 id="neutral-count">0</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="counter_increment('neutral')" class="btn">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  </fieldset>
Â  Â  Â  Â  Â  Â  Â  Â  <fieldset class="counter-fieldset emergency-fieldset">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <legend>Emergency</legend>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 id="emergency-count">0</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="counter_increment('emergency')" class="btn">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  </fieldset>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="info-box" style="padding: 0; margin: 0;">
Â  Â  Â  Â  Â  Â  Â  Â  <fieldset>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <legend id="emergency-log-legend">Today's Emergency Log</legend>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="padding: 5px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="emergency-log" readonly rows="3"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </fieldset>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <hr>

Â  Â  Â  Â  Â  Â  <fieldset id="add-task-fieldset">
Â  Â  Â  Â  Â  Â  Â  Â  <legend>Add New Task</legend>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="newTask" style="flex: 0 0 100px;">Task (Required):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="newTask" type="text" placeholder="Brief description of the taskâ€¦"/>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="toolbar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn" id="addBtn"><i class="fas fa-plus"></i> Add Task</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn ghost" id="resetAllBtn" title="Delete ALL tasks & Today's Counters"><i class="fas fa-trash-alt"></i> Reset All</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <div id="progress-bar-container" class="linear-progress-box">
Â  Â  Â  Â  Â  Â  Â  <div class="head">
Â  Â  Â  Â  Â  _D<span class="big" id="pct1">0%</span> <span class="muted">Overall Progress</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="muted"><span id="done1">0</span>/<span id="total1">0</span> Tasks</div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="bar1" class="bar"></div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <fieldset>
Â  Â  Â  Â  Â  Â  Â  Â  <legend>Historical View</legend>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="history-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="history-date-input">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn" id="history-load-btn">Load Date</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn ghost" id="history-today-btn" style="display: none;">Back to Today</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <fieldset id="dread-analysis-fieldset" class="info-box" style="padding: 8px; margin-top: 15px;">
Â  Â  Â  Â  Â  Â  Â  Â  <legend>Dread Analysis</legend>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="dread-analysis-panel">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Most Evaded Task:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="dread-task-name" class="task-name">(None)</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <fieldset id="task-list-fieldset">
Â  Â  Â  Â  Â  Â  Â  Â  Â <legend id="task-list-legend">Current Tasks</legend>
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="task-list-box">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <ul id="list"></ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="emptyMessage" class="muted" style="text-align: center; margin-top: 8px; font-weight: bold; display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â No tasks currently. Start by adding one!
Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  _ Â  Â  Â </fieldset>
Â  Â  Â  Â  </div> 
       
       <div id="page-notes" style="display: none;">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="notes-list-view">
Â  Â  Â  Â  Â  Â  Â  Â  <fieldset>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <legend>Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙŠ (Notes)</legend>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="toolbar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn" id="notes-new-btn"><i class="fas fa-plus"></i> Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-list-box" style="min-height: 400px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul id="notes-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="notes-empty-msg" class="muted" style="text-align: center; margin-top: 8px; font-weight: bold; display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø­Ø¯Ø©!
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </fieldset>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="notes-editor-view" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â <fieldset>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <legend>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</legend>
                    
                    <input id="notes-editor-title" 
                           type="text" 
                           placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†..." 
                           style="font-size: 1.2rem; font-weight: bold; margin-bottom: 8px; width: 100%;"/>
                    
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="notes-editor-area" rows="15" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="toolbar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn" id="notes-save-btn"><i class="fas fa-save"></i> Ø­ÙØ¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn ghost" id="notes-delete-btn"><i class="fas fa-trash-alt"></i> Ø­Ø°Ù</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="toolbar" style="margin-top: 4px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn ghost" id="notes-back-btn" style="width: 100%;"><i class="fas fa-arrow-left"></i> Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â </fieldset>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div> 
       </div> Â  Â  Â  <div class="status-bar">
Â  Â  Â  Â  Â  <button class="start-btn">Start</button> <div class="separator"></div>
Â  Â  Â  Â  Â  <div class="status-panel" style="flex-grow: 1; margin-right: 0; text-align: left; min-width: 0;">
Â  Â  Â  Â  Â  Â  Â  mohammed tasks
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="status-panel-group">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="status-panel status-panel-btn" id="nav-notes-btn" role="button" title="My Notes">
Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-book"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="status-panel status-panel-btn" id="reset-today-panel-btn" role="button" title="Reset Today's Counters & Log">
Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-undo"></i> Reset Today
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="status-panel" id="status-total">Total: 0</div>
Â  Â  Â  Â  Â  Â  <div class="status-panel" id="status-save">Ready</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </main>

Â  <audio id="sound-tada" src="https://www.myinstants.com/media/sounds/tada.mp3" preload="auto"></audio>
Â  <audio id="sound-error" src="https://www.myinstants.com/media/sounds/windows-xp-error.mp3" preload="auto"></audio>

<script>
// =================================================================
// ğŸ”¥ FIREBASE INITIALIZATION & CONFIG ğŸ”¥
// =================================================================
const firebaseConfig = {
Â  apiKey: "AIzaSyBvpcUP-DmXH82WHgm4ZLHezeBFaaxMnCE",
Â  authDomain: "mohammedtasksapp.firebaseapp.com",
Â  databaseURL: "https://mohammedtasksapp-default-rtdb.asia-southeast1.firebasedatabase.app",
Â  projectId: "mohammedtasksapp",
Â  storageBucket: "mohammedtasksapp.firebasestorage.app",
Â  messagingSenderId: "271781862481",
Â  appId: "1:271781862481:web:dfd63b2c4b4a8d74ad2c70"
};

let db = null;
try {
Â  Â  if (!firebase.apps.length) {
Â  Â  Â  Â  firebase.initializeApp(firebaseConfig);
Â  Â  Â  Â  console.log("Firebase initialized successfully.");
Â  Â  } else {
Â  Â  Â  Â  firebase.app();
Â  Â  Â  Â  console.log("Firebase already initialized.");
Â  Â  }
Â  Â  db = firebase.database();
} catch (e) {
Â  Â  console.error("Firebase initialization failed:", e);
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  const statusSaveEl = document.getElementById('status-save');
Â  Â  Â  Â  if (statusSaveEl) statusSaveEl.textContent = 'DB Init Error!';
Â  Â  Â  Â  alert("CRITICAL ERROR: Could not connect to the database. Please check your internet connection and Firebase configuration.");
Â  Â  });
}

// =================================================================
// ğŸ”¥ GLOBAL VARIABLES & DOM ELEMENTS ğŸ”¥
// =================================================================
let todayCounterRef = null;
let currentCounters = { achievements: 0, neutral: 0, emergency: 0, emergencyLog: [] };
let isViewingHistory = false;
let tasks = [];

// ğŸ”¥ Ù…ØªØºÙŠØ±Ø§Øª ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
let notesRef = null;
let notes = [];
let currentEditingNoteId = null;


// DOM Elements
let listEl, newTaskEl, addBtn, resetAllBtn, emptyMessageEl, statusTotalEl, statusSaveEl, startBtn;
let historyDateInput, historyLoadBtn, historyTodayBtn;
let dreadTaskNameEl;
let allCounterButtons;
let resetTodayBtnEl; 
let logTextareaEl, emergencyLogLegendEl;
let soundTada, soundError;
let logonScreenEl, logonBtnEl;
let addTaskFieldset, progressBarContainer, dreadAnalysisFieldset, taskListLegendEl;

// ğŸ”¥ Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
let pageTasks, pageNotes, notesListView, notesEditorView, notesListEl, notesEmptyMsg, notesNewBtn, notesEditorArea, notesSaveBtn, notesDeleteBtn, notesBackBtn, navNotesBtn;
let notesEditorTitle; // ğŸ”¥ [Ø¬Ø¯ÙŠØ¯] Ù…ØªØºÙŠØ± Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†


// =================================================================
// ğŸ”¥ COUNTER LOGIC (Firebase) ğŸ”¥
// =================================================================
// ... (Ø¯Ø§Ù„Ø© counter_getTodayDateString ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)
function counter_getTodayDateString() {
Â  Â  const today = new Date();
Â  Â  const year = today.getFullYear();
Â  Â  const month = String(today.getMonth() + 1).padStart(2, '0');
Â  Â  const day = String(today.getDate()).padStart(2, '0');
Â  Â  return `${year}-${month}-${day}`;
}

// ... (Ø¯Ø§Ù„Ø© counter_listenForChanges ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)
function counter_listenForChanges(dateString) {
Â  Â  if (!db) {
Â  Â  Â  Â  console.warn("DB not initialized, cannot listen for counter changes.");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  const dateToLoad = dateString || counter_getTodayDateString();
Â  Â  const newRefPath = 'dailyCounters/' + dateToLoad;
Â  Â  const newRef = db.ref(newRefPath);Â 
Â  Â  if (todayCounterRef && todayCounterRef.toString() !== newRef.toString()) {
Â  Â  Â  Â  console.log("Turning off listener for:", todayCounterRef.toString());
Â  Â  Â  Â  todayCounterRef.off('value');
Â  Â  Â  Â  todayCounterRef = null;
Â  Â  }
Â  Â  if (!todayCounterRef) {
Â  Â  Â  Â  console.log("Attaching listener for:", newRefPath);
Â  Â  Â  Â  todayCounterRef = newRef;Â 
Â  Â  Â  Â  todayCounterRef.on('value', (snapshot) => {
Â  Â  Â  Â  Â  Â  const data = snapshot.val();
Â  Â  Â  Â  Â  Â  console.log("Counter data received for", dateToLoad, ":", data);
Â  Â  Â  Â  Â  Â  if (data) {
Â  Â  Â  Â  Â  Â  Â  Â  currentCounters = { ...data, emergencyLog: data.emergencyLog || [] };
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  currentCounters = { achievements: 0, neutral: 0, emergency: 0, emergencyLog: [] };
Â  Â  Â  Â  Â  Â  Â  Â  if (!isViewingHistory && dateToLoad === counter_getTodayDateString()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Setting default counters for today.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  todayCounterRef.set(currentCounters).catch(e => console.error("Initial counter set failed:", e));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateCounterUI();Â 
Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  console.error(`Firebase Counter Read Failed for ${dateToLoad}. Check Rules:`, error);
Â  Â  Â  Â  Â  Â  if (statusSaveEl) updateStatus('Counter Sync Error');
Â  Â  Â  Â  Â  Â  currentCounters = { achievements: 0, neutral: 0, emergency: 0, emergencyLog: [] };
Â  Â  Â  Â  Â  Â  updateCounterUI();
Â  Â  Â  Â  });
Â  Â  } else {
Â  Â  Â  Â console.log("Already listening to:", newRefPath);
Â  Â  Â  Â updateCounterUI();
Â  Â  }
}

// ... (Ø¯Ø§Ù„Ø© updateCounterUI ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)
function updateCounterUI() {
Â  Â  const achEl = document.getElementById('achievements-count');
Â  Â  const neuEl = document.getElementById('neutral-count');
Â  Â  const emgEl = document.getElementById('emergency-count');
Â  Â  if (achEl) achEl.innerText = currentCounters.achievements || 0;
Â  Â  if (neuEl) neuEl.innerText = currentCounters.neutral || 0;
Â  Â  if (emgEl) emgEl.innerText = currentCounters.emergency || 0;
Â  Â  const logData = currentCounters.emergencyLog || [];
Â  Â  if (logTextareaEl) {
Â  Â  Â  Â  if (logData.length > 0) {
Â  Â  Â  Â  Â  Â  logTextareaEl.value = logData.join('\n');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â logTextareaEl.value = isViewingHistory ? '(No data for this day)' : '(No emergencies logged today)';
Â  Â  Â  Â  }
Â  Â  Â  Â  logTextareaEl.scrollTop = logTextareaEl.scrollHeight;
Â  Â  }
Â  Â  if (allCounterButtons) {
Â  Â  Â  Â  allCounterButtons.forEach(btn => btn.disabled = isViewingHistory);
Â  Â  }
Â  Â  if (historyTodayBtn) historyTodayBtn.style.display = isViewingHistory ? 'inline-block' : 'none';
Â  Â  if (historyLoadBtn) historyLoadBtn.style.display = isViewingHistory ? 'none' : 'inline-block';
Â  Â  if (emergencyLogLegendEl) {
Â  Â  Â  Â  emergencyLogLegendEl.textContent = isViewingHistory && historyDateInput ? `Emergency Log (${historyDateInput.value})` : "Today's Emergency Log";
Â  Â  }
Â  Â  const showTodayElements = !isViewingHistory;
Â  Â  if (addTaskFieldset) addTaskFieldset.style.display = showTodayElements ? '' : 'none';
Â  Â  if (progressBarContainer) progressBarContainer.style.display = showTodayElements ? '' : 'none';
Â  Â  if (dreadAnalysisFieldset) dreadAnalysisFieldset.style.display = showTodayElements ? '' : 'none';
Â  Â  if (taskListLegendEl) taskListLegendEl.textContent = showTodayElements ? "Current Tasks" : (historyDateInput ? `Tasks Created On (${historyDateInput.value})` : "Tasks");
}

// ... (Ø¯Ø§Ù„Ø© counter_increment ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)
function counter_increment(type) {
Â  Â  if (!db || !todayCounterRef) {
Â  Â  Â  Â  console.warn("Cannot increment counter, DB or ref not ready.");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  if (isViewingHistory) {
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  let finalReason = "";
Â  Â  let updates = {};Â 
Â  Â  if (type === 'emergency') {
Â  Â  Â  Â  let reasonInput = prompt("EMERGENCY:\n\n1. Social Media\n2. Phone/Calls\n3. Procrastination\n4. Other (Specify)", "");
Â  Â  Â  Â  if (reasonInput === null) return;Â 
Â  Â  Â  Â  if (reasonInput === "1") finalReason = "Social Media";
Â  Â  Â  Â  else if (reasonInput === "2") finalReason = "Phone/Calls";
Â  Â  Â  Â  else if (reasonInput === "3") finalReason = "Procrastination";
Â  Â  Â  Â  else if (reasonInput === "4") finalReason = prompt("Specify 'Other' reason:", "") || "Other (Unspecified)";
Â  Â  Â  Â  else if (reasonInput.trim() !== "") finalReason = reasonInput.trim();
Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  finalReason = "Other (Unspecified)";
Â  Â  Â  Â  }
Â  Â  Â  Â  const currentLog = Array.isArray(currentCounters.emergencyLog) ? [...currentCounters.emergencyLog] : [];
Â  Â  Â  Â  currentLog.push(finalReason);
Â  Â  Â  Â  updates.emergencyLog = currentLog;Â 
Â  Â  Â  Â  if (soundError) soundError.play().catch(e => console.warn("Audio play failed:", e));
Â  Â  }
Â  Â  todayCounterRef.child(type).transaction((currentCount) => {
Â  Â  Â  Â  return (currentCount || 0) + 1;
Â  Â  }, (error, committed, snapshot) => {
Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  console.error('Counter transaction failed abnormally!', error);
Â  Â  Â  Â  Â  Â  updateStatus('Counter Save Error');
Â  Â  Â  Â  } else if (!committed) {
Â  Â  Â  Â  Â  Â  console.warn('Counter transaction not committed (concurrent modification?).');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.log('Counter transaction committed.');
Â  Â  Â  Â  Â  Â  const newCount = snapshot.val();Â 
Â  Â  Â  Â  Â  Â  if (type === 'achievements' && newCount === 10) {
Â  Â  Â  Â  Â  Â  Â  Â  Â alert("Congratulations! 10 Achievements! You deserve a prize!");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  });
Â  Â  if (updates.emergencyLog) {
Â  Â  Â  Â  Â todayCounterRef.update({ emergencyLog: updates.emergencyLog }).catch(e => {
Â  Â  Â  Â  Â  Â  console.error("Emergency log update failed:", e);
Â  Â  Â  Â  Â  Â  updateStatus('Log Save Error');
Â  Â  Â  Â  });
Â  Â  }
}


// =================================================================
// ğŸ”¥ TASK APP LOGIC (Firebase) ğŸ”¥
// =================================================================

const tasksRef = db ? db.ref('tasks') : null;

// ... (Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… Ù…Ù† todayDate Ø¥Ù„Ù‰ updateLinearView ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ)
function todayDate() { return new Date().toISOString().substring(0, 10); }

function updateStatus(message) {
Â  Â  if (statusSaveEl) {
Â  Â  Â  Â  statusSaveEl.textContent = message;
Â  Â  Â  Â  const isError = /error|fail/i.test(message);Â 
Â  Â  Â  Â  if (!isError) {
Â  Â  Â  Â  Â  Â  Â setTimeout(() => { if (statusSaveEl && statusSaveEl.textContent === message) statusSaveEl.textContent = 'Ready'; }, 2000);
Â  Â  Â  Â  }
Â  Â  }
}

function listenForTasks() {
Â  Â  if (!tasksRef) {
Â  Â  Â  Â  Â console.warn("DB not initialized, cannot listen for task changes.");
Â  Â  Â  Â  Â return;
Â  Â  }
Â  Â  tasksRef.on('value', (snapshot) => {
Â  Â  Â  Â  const rawData = snapshot.val();
Â  Â  Â  Â  tasks = [];Â 
Â  Â  Â  Â  if (rawData) {
Â  Â  Â  Â  Â  Â  for (let id in rawData) {
Â  Â  Â  Â  Â  Â  Â  Â  tasks.push({ ...rawData[id], id: id, dreadCount: rawData[id].dreadCount || 0 });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (!isViewingHistory) {
Â  Â  Â  Â  Â  Â  renderList();Â 
Â  Â  Â  Â  Â  Â  updateLinearView();
Â  Â  Â  Â  Â  Â  updateDreadAnalysis();
Â  Â  Â  Â  }
Â  Â  Â  Â  updateStatus('Synced');
Â  Â  }, (error) => {
Â  Â  Â  Â  console.error("Firebase Task Read Failed. Check Rules:", error);
Â  Â  Â  Â  updateStatus('Task Sync Error');
Â  Â  });
}

function addTaskToDB(text) {
Â  Â  if (!tasksRef) return;
Â  Â  const newTask = { text: text, done: false, createdDate: todayDate(), dreadCount: 0 };
Â  Â  tasksRef.push(newTask).catch((error) => {
Â  Â  Â  Â  console.error("Firebase Write Failed. Check Rules.", error);
Â  Â  Â  Â  updateStatus('Write Error');
Â  Â  });
}

function updateTaskStatus(id, isDone) {
Â  Â  if (!tasksRef) return;
Â  Â  tasksRef.child(id).update({ done: isDone }).catch((error) => {
Â  Â  Â  Â  console.error("Firebase Update Failed. Check Rules.", error);
Â  Â  Â  Â  updateStatus('Update Error');
Â  Â  });
Â  Â  if (isDone && soundTada) soundTada.play().catch(e => console.warn("Audio play failed:", e));
}

function incrementDreadCount(id) {
Â  Â  if (!tasksRef) return;
Â  Â  tasksRef.child(id).child('dreadCount').transaction((currentCount) => {
Â  Â  Â  Â  return (currentCount || 0) + 1;
Â  Â  });
}

function deleteTask(id) {
Â  Â  if (!tasksRef) return;
Â  Â  tasksRef.child(id).remove().catch((error) => {
Â  Â  Â  Â  console.error("Firebase Delete Failed. Check Rules.", error);
Â  Â  Â  Â  updateStatus('Delete Error');
Â  Â  });
}

function deleteAllTasks() {
Â  Â  if (!tasksRef) return;
Â  Â  tasksRef.remove().catch((error) => {
Â  Â  Â  Â  console.error("Firebase Clear Failed. Check Rules.", error);
Â  Â  Â  Â  updateStatus('Clear Error');
Â  Â  });
}

function renderList(tasksToRender) {
Â  Â  const displayTasks = tasksToRender || tasks;Â 
Â  Â  const sortedTasks = [...displayTasks].sort((a, b) => (b.createdDate || "").localeCompare(a.createdDate || ""));
Â  Â  if (!listEl) return;
Â  Â  listEl.innerHTML = '';
Â  Â  const isInHistory = isViewingHistory;Â 
Â  Â  if (sortedTasks.length === 0) {
Â  Â  Â  Â  if (emptyMessageEl) {
Â  Â  Â  Â  Â  Â  Â emptyMessageEl.textContent = isInHistory ? "No tasks created on this date." : "No tasks currently. Start by adding one!";
Â  Â  Â  Â  Â  Â  Â emptyMessageEl.style.display = 'block';
Â  Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  Â  if (emptyMessageEl) emptyMessageEl.style.display = 'none';
Â  Â  }
Â  Â  sortedTasks.forEach(t => {
Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  if (t.done) li.classList.add('done');
Â  Â  Â  Â  const cb = document.createElement('input');
Â  Â  Â  Â  cb.type = 'checkbox';
Â  Â  Â  Â  cb.checked = t.done;
Â  Â  Â  Â  cb.disabled = isInHistory;Â 
Â  Â  Â  Â  if (!isInHistory) {
Â  Â  Â  Â  Â  Â  cb.addEventListener('change', () => { updateTaskStatus(t.id, cb.checked); });
Â  Â  Â  Â  }
Â  Â  Â  Â  const span = document.createElement('span');
Â  Â  Â  Â  span.className = 'txt';
Â  Â  Â  Â  span.textContent = t.text;
Â  Â  Â  Â  const dreadBtn = document.createElement('button');
Â  Â  Â  Â  dreadBtn.className = 'dread-btn';
Â  Â  Â  Â  dreadBtn.title = `Mark as dreaded (${t.dreadCount || 0})`;
Â  Â  Â  Â  dreadBtn.innerHTML = 'ğŸ˜°';
Â  Â  Â  Â  dreadBtn.disabled = isInHistory;Â 
Â  Â  Â  Â  if (!isInHistory) {
Â  Â  Â  Â  Â  Â  Â dreadBtn.addEventListener('click', () => { incrementDreadCount(t.id); });
Â  Â  Â  Â  }
Â  Â  Â  Â  const del = document.createElement('button');
Â  Â  Â  Â  del.className = 'del';
Â  Â  Â  Â  del.innerHTML = '<i class="fas fa-trash"></i>';
Â  Â  Â  Â  del.disabled = isInHistory;Â 
Â  Â  Â  Â  if (!isInHistory) {
Â  Â  Â  Â  Â  Â  Â del.addEventListener('click', () => { deleteTask(t.id); });
Â  Â  Â  Â  }
Â  Â  Â  Â  li.appendChild(cb);
Â  Â  Â  Â  li.appendChild(span);
Â  Â  Â  Â  li.appendChild(dreadBtn);
Â  Â  Â  Â  li.appendChild(del);
Â  Â  Â  Â  listEl.appendChild(li);
Â  Â  });
Â  Â  if (statusTotalEl) statusTotalEl.textContent = `Total: ${tasks.length}`;
}

function updateDreadAnalysis() {
Â  Â  if (!dreadTaskNameEl) return;
Â  Â  const pendingTasks = tasks.filter(t => !t.done);
Â  Â  if (pendingTasks.length === 0) {
Â  Â  Â  Â  Â dreadTaskNameEl.textContent = '(None)';
Â  Â  Â  Â  Â return;
Â  Â  }
Â  Â  const mostDreaded = pendingTasks.sort((a, b) => {
Â  Â  Â  Â  const dreadDiff = (b.dreadCount || 0) - (a.dreadCount || 0);
Â  Â  Â  Â  if (dreadDiff !== 0) return dreadDiff;
Â  Â  Â  Â  return (b.createdDate || "").localeCompare(a.createdDate || "");
Â  Â  })[0];
Â  Â  if (mostDreaded && mostDreaded.dreadCount > 0) {
Â  Â  Â  Â  dreadTaskNameEl.textContent = `${mostDreaded.text} (${mostDreaded.dreadCount})`;
Â  Â  } else {
Â  Â  Â  Â  dreadTaskNameEl.textContent = '(None)';
Â  Â  }
}

function handleAddTask(){
Â  Â  Â if (isViewingHistory) return;Â 
Â  Â  const text = (newTaskEl.value||'').trim();
Â  Â  if(!text) {
Â  Â  Â  Â  alert("Please enter a task description first!");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  addTaskToDB(text);
Â  Â  newTaskEl.value='';
Â  Â  newTaskEl.focus();
}

function handleResetAll(){
Â  Â  if(!confirm('ARE YOU SURE?\n\nThis will delete ALL tasks (permanently!)\nAND reset today\'s counters and log.')) return;
Â  Â  deleteAllTasks();
Â  Â  if (todayCounterRef && !isViewingHistory) {
Â  Â  Â  Â  Â const defaultCounters = { achievements: 0, neutral: 0, emergency: 0, emergencyLog: [] };
Â  Â  Â  Â  Â todayCounterRef.set(defaultCounters).then(() => {
Â  Â  Â  Â  Â  Â  Â updateStatus("All Reset");
Â  Â  Â  Â  Â }).catch(e => console.error("Counter reset failed:", e));
Â  Â  }
}

function handleResetTodayCounters() {
Â  Â  if (isViewingHistory) {
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  if (!confirm('Reset Today\'s Counters?\n\nThis will reset Achievements, Neutral, Emergency counts and the Emergency Log for today ONLY.\nTasks will NOT be affected.')) return;
Â  Â  if (todayCounterRef) {
Â  Â  Â  Â  Â const defaultCounters = { achievements: 0, neutral: 0, emergency: 0, emergencyLog: [] };
Â  Â  Â  Â  Â todayCounterRef.set(defaultCounters).then(() => {
Â  Â  Â  Â  Â  Â  Â updateStatus("Counters Reset");
Â  Â  Â  Â  Â }).catch(e => {
Â  Â  Â  Â  Â  Â  console.error("Counter reset failed:", e);
Â  Â  Â  Â  Â  Â  updateStatus('Reset Error');
Â  Â  Â  Â  Â });
Â  Â  }
}

function getProgress(){
Â  Â  const total = tasks.length;
Â  Â  const doneÂ  = tasks.filter(t=>t.done).length;
Â  Â  const pctÂ  Â = total ? Math.round((done/total)*100) : 0;
Â  Â  return {total, done, pct};
}

function updateLinearView(){
Â  Â  const {total,done,pct} = getProgress();
Â  Â  const bar = document.getElementById('bar1');
Â  Â  const pctEl = document.getElementById('pct1');
Â  Â  const doneEl= document.getElementById('done1');
Â  Â  const totalEl= document.getElementById('total1');
Â  Â  if(bar) bar.style.width = pct + '%';
Â  Â  if(pctEl) pctEl.textContent = pct + '%';
Â  Â  if(doneEl) doneEl.textContent = done;
Â  Â  if(totalEl) totalEl.textContent = total;
Â  Â  const pb = document.querySelector('#v-linear .progress[role="progressbar"]');
Â  Â  if(pb) pb.setAttribute('aria-valuenow', pct);
}

// =================================================================
// ğŸ”¥ Ø¯ÙˆØ§Ù„ ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„ØªÙ†Ù‚Ù„
// =================================================================

/**
Â * ÙŠØ¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙˆÙŠØ®ÙÙŠ Ø§Ù„Ø¨Ù‚ÙŠØ©
Â * @param {string} pageId ('page-tasks' or 'page-notes')
Â */
function showPage(pageId) {
Â  Â  if (pageTasks) pageTasks.style.display = (pageId === 'page-tasks') ? 'block' : 'none';
Â  Â  if (pageNotes) pageNotes.style.display = (pageId === 'page-notes') ? 'block' : 'none';
Â  Â Â 
Â  Â  // Ø¹Ù†Ø¯ Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŒ ØªØ£ÙƒØ¯ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ù† Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹
Â  Â  if (pageId === 'page-notes') {
Â  Â  Â  Â  handleBackToList();
Â  Â  }
}

/**
Â * ÙŠØ¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆÙŠØ®ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ø±
Â */
function handleBackToList() {
Â  Â  currentEditingNoteId = null;
Â  Â  if (notesListView) notesListView.style.display = 'block';
Â  Â  if (notesEditorView) notesEditorView.style.display = 'none';
Â  Â  renderNotesList(); // Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª
}

/**
Â * ğŸ”¥ [Ù…Ø¹Ø¯Ù„Ø©] ÙŠØ³ØªÙ…Ø¹ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Firebase (Ù…Ø¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØªØ±ØªÙŠØ¨)
Â */
function listenForNotes() {
Â  if (!notesRef) return;
Â  notesRef.on('value', (snapshot) => {
Â  Â  const rawData = snapshot.val();
Â  Â  notes = [];
Â  Â  if (rawData) {
Â  Â  Â  for (let id in rawData) {
        // ğŸ”¥ [ØªØ¹Ø¯ÙŠÙ„] Ø§Ù‚Ø±Ø£ Ø§Ù„ÙƒØ§Ø¦Ù† ÙƒØ§Ù…Ù„Ø§Ù‹
Â  Â  Â  Â  notes.push({ 
            id: id, 
            title: rawData[id].title, 
            content: rawData[id].content,
            lastModified: rawData[id].lastModified 
        });
Â  Â  Â  }
Â  Â  }
    // ğŸ”¥ [ØªØ¹Ø¯ÙŠÙ„] Ø±ØªØ¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„ (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
Â  Â  notes.sort((a, b) => (b.lastModified || 0) - (a.lastModified || 0));Â 
Â  Â  renderNotesList();
Â  });
}

/**
Â * ğŸ”¥ [Ù…Ø¹Ø¯Ù„Ø©] ÙŠØ¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙÙŠ <ul> (Ù…Ø¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©)
Â */
function renderNotesList() {
Â  if (!notesListEl) return;
Â  notesListEl.innerHTML = '';
Â  if (notes.length === 0) {
Â  Â  if (notesEmptyMsg) notesEmptyMsg.style.display = 'block';
Â  Â  return;
Â  }
Â  if (notesEmptyMsg) notesEmptyMsg.style.display = 'none';

Â  notes.forEach(note => {
Â  Â  const li = document.createElement('li');
Â  Â  li.className = 'note-item';
Â  Â Â 
    // ğŸ”¥ [ØªØ¹Ø¯ÙŠÙ„] Ø£Ø¸Ù‡Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
Â  Â  const title = note.title || '(Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù„Ø§ Ø¹Ù†ÙˆØ§Ù†)';
    const contentPreview = (note.content || '').split('\n')[0] || '(Ù…Ù„Ø§Ø­Ø¸Ø© ÙØ§Ø±ØºØ©)';
Â  Â  const preview = contentPreview.substring(0, 45) + (contentPreview.length > 45 ? '...' : '');
Â  Â Â 
    // Ø§Ø³ØªØ®Ø¯Ù… .txt Ù„Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ ÙˆØ£Ø¶Ù ÙˆØ³Ù… <small> Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
Â  Â  li.innerHTML = `<span class="txt">${title}</span>
                    <small>${preview}</small>`; 
                    
Â  Â  li.addEventListener('click', () => openNoteEditor(note.id));
Â  Â  notesListEl.appendChild(li);
Â  });
}

/**
Â * ğŸ”¥ [Ù…Ø¹Ø¯Ù„Ø©] ÙŠÙØªØ­ Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ù…Ø¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†)
Â * @param {string | null} noteId - Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ÙÙŠ FirebaseØŒ Ø£Ùˆ null Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
Â */
function openNoteEditor(noteId) {
Â  currentEditingNoteId = noteId;
Â  const note = notes.find(n => n.id === noteId);
Â Â 
  // ğŸ”¥ [ØªØ¹Ø¯ÙŠÙ„] Ø§Ù…Ù„Ø£ Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰
Â  if (notesEditorTitle) notesEditorTitle.value = note ? note.title : '';
Â  if (notesEditorArea) notesEditorArea.value = note ? note.content : '';

Â  if (notesListView) notesListView.style.display = 'none';
Â  if (notesEditorView) notesEditorView.style.display = 'block';
Â  if (notesDeleteBtn) notesDeleteBtn.disabled = !noteId; // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù‚Ø¨Ù„ Ø­ÙØ¸Ù‡Ø§
Â Â 
Â  if (notesEditorTitle) notesEditorTitle.focus(); // ğŸ”¥ Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£ÙˆÙ„Ø§Ù‹
}

/**
Â * Ù…Ø¹Ø§Ù„Ø¬ Ø²Ø± "Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©"
Â */
function handleNewNote() {
Â  openNoteEditor(null); // Ø§ÙØªØ­ Ø§Ù„Ù…Ø­Ø±Ø± Ø¨Ù€ ID ÙØ§Ø±Øº
}

/**
Â * ğŸ”¥ [Ù…Ø¹Ø¯Ù„Ø©] Ù…Ø¹Ø§Ù„Ø¬ Ø²Ø± "Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©" (Ù…Ø¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹Ø¯ÙŠÙ„)
Â */
function handleSaveNote() {
Â  if (!notesRef || !notesEditorArea || !notesEditorTitle) return;
Â Â 
  // ğŸ”¥ [ØªØ¹Ø¯ÙŠÙ„] Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
Â  const content = notesEditorArea.value;
  let title = notesEditorTitle.value.trim();

  // ğŸ”¥ [Ø¬Ø¯ÙŠØ¯] Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙØ§Ø±ØºØ§Ù‹ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„ Ø³Ø·Ø± Ù…Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙƒØ¹Ù†ÙˆØ§Ù†
  if (!title) {
     title = content.split('\n')[0].substring(0, 50) || 'Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©';
  }
  
  // ğŸ”¥ [Ø¬Ø¯ÙŠØ¯] ÙƒØ§Ø¦Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯
  const noteData = {
      title: title,
      content: content,
      lastModified: Date.now() // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„ØªØ±ØªÙŠØ¨
  };

Â  updateStatus('Saving Note...');
Â Â 
Â  if (currentEditingNoteId) {
Â  Â  // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø§Ø­Ø¸Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
Â  Â  notesRef.child(currentEditingNoteId).set(noteData) // ğŸ”¥ [ØªØ¹Ø¯ÙŠÙ„]
Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  updateStatus('Note Saved!');
Â  Â  Â  Â  Â  handleBackToList();
Â  Â  Â  })
Â  Â  Â  .catch(e => updateStatus('Save Error!'));
Â  } else {
Â  Â  // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
Â  Â  notesRef.push(noteData) // ğŸ”¥ [ØªØ¹Ø¯ÙŠÙ„]
Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  updateStatus('Note Created!');
Â  Â  Â  Â  Â  handleBackToList();
Â  Â  Â  })
Â  Â  Â  .catch(e => updateStatus('Save Error!'));
Â  }
}

/**
Â * Ù…Ø¹Ø§Ù„Ø¬ Ø²Ø± "Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©"
Â */
function handleDeleteNote() {
Â  if (!currentEditingNoteId) return; 
Â  if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø±.')) return;
Â Â 
Â  updateStatus('Deleting Note...');
Â  notesRef.child(currentEditingNoteId).remove()
Â  Â  .then(() => {
Â  Â  Â  Â  updateStatus('Note Deleted!');
Â  Â  Â  Â  handleBackToList();
Â  Â  })
Â  Â  .catch(e => updateStatus('Delete Error!'));
}


// =================================================================
// ğŸ”¥ INIT (Assign Elements & Attach Listeners) ğŸ”¥
// =================================================================
document.addEventListener('DOMContentLoaded', () => {

Â  Â  // Assign DOM Elements Safely
Â  Â  listEl = document.getElementById('list');
Â  Â  newTaskEl = document.getElementById('newTask');
Â  Â  addBtn = document.getElementById('addBtn');
Â  Â  resetAllBtn = document.getElementById('resetAllBtn');
Â  Â  emptyMessageEl = document.getElementById('emptyMessage');
Â  Â  statusTotalEl = document.getElementById('status-total');
Â  Â  statusSaveEl = document.getElementById('status-save');
Â  Â  dreadTaskNameEl = document.getElementById('dread-task-name');
Â  Â  allCounterButtons = document.querySelectorAll('.counter-fieldset button');
Â  Â  logTextareaEl = document.getElementById('emergency-log');
Â  Â  emergencyLogLegendEl = document.getElementById('emergency-log-legend');Â 
Â  Â  soundTada = document.getElementById('sound-tada');
Â  Â  soundError = document.getElementById('sound-error');
Â  Â  addTaskFieldset = document.getElementById('add-task-fieldset');
Â  Â  progressBarContainer = document.getElementById('progress-bar-container');Â 
Â  Â  dreadAnalysisFieldset = document.getElementById('dread-analysis-fieldset');
Â  Â  taskListLegendEl = document.getElementById('task-list-legend');Â 

Â  Â  logonScreenEl = document.getElementById('logon-screen');
Â  Â  logonBtnEl = document.getElementById('logon-ok');
Â  Â Â 
Â  Â  resetTodayBtnEl = document.getElementById('reset-today-panel-btn');
Â  Â  startBtn = document.querySelector('.start-btn'); 

Â  Â  historyDateInput = document.getElementById('history-date-input');
Â  Â  historyLoadBtn = document.getElementById('history-load-btn');
Â  Â  historyTodayBtn = document.getElementById('history-today-btn');

Â  Â  Â // ğŸ”¥ [Ø¬Ø¯ÙŠØ¯] ØªØ­Ø¯ÙŠØ¯ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„ØªÙ†Ù‚Ù„
Â  Â  pageTasks = document.getElementById('page-tasks');
Â  Â  pageNotes = document.getElementById('page-notes');
Â  Â  notesListView = document.getElementById('notes-list-view');
Â  Â  notesEditorView = document.getElementById('notes-editor-view');
Â  Â  notesListEl = document.getElementById('notes-list');
Â  Â  notesEmptyMsg = document.getElementById('notes-empty-msg');
Â  Â  notesNewBtn = document.getElementById('notes-new-btn');
Â  Â  notesEditorArea = document.getElementById('notes-editor-area');
Â  Â  notesEditorTitle = document.getElementById('notes-editor-title'); // ğŸ”¥ [Ø¬Ø¯ÙŠØ¯] Ø±Ø¨Ø· Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
Â  Â  notesSaveBtn = document.getElementById('notes-save-btn');
Â  Â  notesDeleteBtn = document.getElementById('notes-delete-btn');
Â  Â  notesBackBtn = document.getElementById('notes-back-btn');
Â  Â  navNotesBtn = document.getElementById('nav-notes-btn');

Â  Â  // Logon Screen Logic
Â  Â  if (logonBtnEl) {
Â  Â  Â  Â  logonBtnEl.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (logonScreenEl) logonScreenEl.style.display = 'none';
Â  Â  Â  Â  });
Â  Â  } else { console.warn("Logon button not found."); }
Â  Â Â 
Â  Â  // Reset Today Button Logic
Â  Â  if (resetTodayBtnEl) {
Â  Â  Â  Â  resetTodayBtnEl.addEventListener('click', handleResetTodayCounters);
Â  Â  } else { console.warn("Reset Today button not found."); }

Â  Â  // Task App Listeners
Â  Â  if (addBtn) addBtn.addEventListener('click', handleAddTask); else { console.warn("Add Task button not found."); }
Â  Â  if (newTaskEl) newTaskEl.addEventListener('keydown', e => { if(e.key==='Enter') handleAddTask(); }); else { console.warn("New task input not found."); }
Â  Â  if (resetAllBtn) resetAllBtn.addEventListener('click', handleResetAll); else { console.warn("Reset All button not found."); }

Â  Â  // History View Listeners
Â  Â  if (historyLoadBtn && historyDateInput) {
Â  Â  Â  Â  historyLoadBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const date = historyDateInput.value;
Â  Â  Â  Â  Â  Â  if (!date) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Please select a date first.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  isViewingHistory = true;
Â  Â  Â  Â  Â  Â  const filteredTasks = tasks.filter(task => task.createdDate === date);
Â  Â  Â  Â  Â  Â  renderList(filteredTasks);Â 
Â  Â  Â  Â  Â  Â  counter_listenForChanges(date);Â 
Â  Â  Â  Â  });
Â  Â  } else { console.warn("History Load button or date input not found."); }

Â  Â  if (historyTodayBtn) {
Â  Â  Â  Â  historyTodayBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  isViewingHistory = false;
Â  Â  Â  Â  Â  Â  historyDateInput.value = '';
Â  Â  Â  Â  Â  Â  renderList();Â 
Â  Â  Â  Â  Â  Â  counter_listenForChanges(null);Â 
Â  Â  Â  Â  });
Â  Â  } else { console.warn("History Today button not found."); }


Â  Â  // ğŸ”¥ Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
Â  Â  if(startBtn) {
Â  Â  Â  Â  startBtn.addEventListener('click', () => showPage('page-tasks'));
Â  Â  }
Â  Â  if(navNotesBtn) {
Â  Â  Â  Â  navNotesBtn.addEventListener('click', () => showPage('page-notes'));
Â  Â  }
Â  Â  if(notesNewBtn) notesNewBtn.addEventListener('click', handleNewNote);
Â  Â  if(notesSaveBtn) notesSaveBtn.addEventListener('click', handleSaveNote);
Â  Â  if(notesDeleteBtn) notesDeleteBtn.addEventListener('click', handleDeleteNote);
Â  Â  if(notesBackBtn) notesBackBtn.addEventListener('click', handleBackToList);


Â  Â  // Start Firebase Listeners (only if db initialized)
Â  Â  if (db) {
Â  Â  Â  Â  // ğŸ”¥ ØªØ¹Ø±ÙŠÙ Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
Â  Â  Â  Â  notesRef = db.ref('notes');

Â  Â  Â  Â  listenForTasks(); // Listens for ALL tasks
Â  Â  Â  Â  counter_listenForChanges(null); // Initial load for today's counters
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ğŸ”¥ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
Â  Â  Â  Â  listenForNotes();

Â  Â  } else {
Â  Â  Â  Â  if(statusSaveEl) statusSaveEl.textContent = 'DB Connection Error!';
Â  Â  Â  Â  console.error("Firebase DB object not initialized. Cannot start listeners.");
Â  Â  Â  Â  // Disable UI elements reliant on DB
Â  Â  Â  Â  Â const elementsToDisable = [addBtn, resetAllBtn, resetTodayBtnEl, historyLoadBtn, newTaskEl, navNotesBtn, notesNewBtn, notesSaveBtn, notesDeleteBtn];
Â  Â  Â  Â  Â elementsToDisable.forEach(el => { if (el) el.disabled = true; });
Â  Â  Â  Â  Â if (allCounterButtons) allCounterButtons.forEach(btn => btn.disabled = true);
Â  Â  }
});
</script>
</body>
</html>
